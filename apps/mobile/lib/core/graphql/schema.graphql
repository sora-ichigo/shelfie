"""Error object for authentication operations"""
type AuthError {
  """Error code"""
  code: AuthErrorCode

  """Field that caused the error, if applicable"""
  field: String

  """Human-readable error message"""
  message: String

  """Whether the operation can be retried"""
  retryable: Boolean
}

"""Error codes for authentication operations"""
enum AuthErrorCode {
  EMAIL_ALREADY_EXISTS
  INTERNAL_ERROR
  INVALID_CREDENTIALS
  INVALID_PASSWORD
  INVALID_TOKEN
  NETWORK_ERROR
  TOKEN_EXPIRED
  UNAUTHENTICATED
  USER_NOT_FOUND
}

"""Error object for query results"""
type AuthErrorResult {
  """Error code"""
  code: AuthErrorCode

  """Field that caused the error, if applicable"""
  field: String

  """Human-readable error message"""
  message: String

  """Whether the operation can be retried"""
  retryable: Boolean
}

"""
A date-time string at UTC, such as 2007-12-03T10:15:30Z, compliant with the `date-time` format outlined in section 5.6 of the RFC 3339 profile of the ISO 8601 standard for representation of dates and times using the Gregorian calendar.
"""
scalar DateTime

"""Result of successful login"""
type LoginResult {
  """Firebase ID token for API authentication"""
  idToken: String!

  """Firebase refresh token for obtaining new ID tokens"""
  refreshToken: String!

  """Logged in user"""
  user: User!
}

"""Input for user login"""
input LoginUserInput {
  """Email address"""
  email: String!

  """Password"""
  password: String!
}

"""Result of me query - either User or AuthErrorResult"""
union MeResult = AuthErrorResult | User

type Mutation {
  """Add a book to the user's shelf"""
  addBookToShelf(bookInput: AddBookInput!): UserBook!

  """Login with email and password"""
  loginUser(input: LoginUserInput!): MutationLoginUserResult

  """Refresh ID token using refresh token"""
  refreshToken(input: RefreshTokenInput!): MutationRefreshTokenResult

  """Register a new user with email and password"""
  registerUser(input: RegisterUserInput!): MutationRegisterUserResult

  """Update the reading status of a book in the user's shelf"""
  updateReadingStatus(userBookId: Int!, status: ReadingStatus!): UserBook!

  """Update the reading note of a book in the user's shelf"""
  updateReadingNote(userBookId: Int!, note: String!): UserBook!

  """Remove a book from the user's shelf"""
  removeFromShelf(userBookId: Int!): Boolean!
}

union MutationLoginUserResult = AuthError | MutationLoginUserSuccess

type MutationLoginUserSuccess {
  data: LoginResult!
}

union MutationRefreshTokenResult = AuthError | MutationRefreshTokenSuccess

type MutationRefreshTokenSuccess {
  data: RefreshTokenResult!
}

union MutationRegisterUserResult = AuthError | MutationRegisterUserSuccess

type MutationRegisterUserSuccess {
  data: User!
}

type Query {
  health: String

  """Get the currently authenticated user"""
  me: MeResult!

  """Search for a book by ISBN"""
  searchBookByISBN(isbn: String!): Book

  """Search for books by keyword"""
  searchBooks(query: String!, limit: Int, offset: Int): SearchBooksResult!

  """Get detailed information about a book by ID"""
  bookDetail(bookId: String!): BookDetail!

  """Get the user's reading record for a book by external ID"""
  userBookByExternalId(externalId: String!): UserBook

  """Get all books in the user's shelf"""
  myShelf: [UserBook!]!
}

"""Input for token refresh"""
input RefreshTokenInput {
  """Refresh token"""
  refreshToken: String!
}

"""Result of successful token refresh"""
type RefreshTokenResult {
  """New Firebase ID token"""
  idToken: String!

  """New refresh token"""
  refreshToken: String!
}

"""Input for user registration"""
input RegisterUserInput {
  """Email address"""
  email: String!

  """Password"""
  password: String!
}

"""A user in the system"""
type User {
  """When the user was created"""
  createdAt: DateTime

  """The email address of the user"""
  email: String

  """The unique identifier of the user"""
  id: Int

  """When the user was last updated"""
  updatedAt: DateTime
}

"""A book from the search results"""
type Book {
  """The unique identifier of the book"""
  id: String!

  """The title of the book"""
  title: String!

  """The authors of the book"""
  authors: [String!]!

  """The publisher of the book"""
  publisher: String

  """The publication date of the book"""
  publishedDate: String

  """The ISBN of the book"""
  isbn: String

  """The cover image URL of the book"""
  coverImageUrl: String
}

"""Search results containing a list of books"""
type SearchBooksResult {
  """The list of books found"""
  items: [Book!]!

  """The total number of books found"""
  totalCount: Int!

  """Whether there are more books to fetch"""
  hasMore: Boolean!
}

"""Input for adding a book to the shelf"""
input AddBookInput {
  """The external ID of the book"""
  externalId: String!

  """The title of the book"""
  title: String!

  """The authors of the book"""
  authors: [String!]!

  """The publisher of the book"""
  publisher: String

  """The publication date of the book"""
  publishedDate: String

  """The ISBN of the book"""
  isbn: String

  """The cover image URL of the book"""
  coverImageUrl: String
}

"""Reading status of a book in the user's shelf"""
enum ReadingStatus {
  """Unread (backlog)"""
  BACKLOG
  """Currently reading"""
  READING
  """Finished reading"""
  COMPLETED
  """Dropped/Not reading"""
  DROPPED
}

"""A book in the user's shelf"""
type UserBook {
  """The unique identifier of the user book"""
  id: Int!

  """The external ID of the book"""
  externalId: String!

  """The title of the book"""
  title: String!

  """The authors of the book"""
  authors: [String!]!

  """The publisher of the book"""
  publisher: String

  """The publication date of the book"""
  publishedDate: String

  """The ISBN of the book"""
  isbn: String

  """The cover image URL of the book"""
  coverImageUrl: String

  """When the book was added to the shelf"""
  addedAt: DateTime!

  """The reading status of the book"""
  readingStatus: ReadingStatus!

  """When the book was marked as completed"""
  completedAt: DateTime

  """User's reading note for the book"""
  note: String

  """When the note was last updated"""
  noteUpdatedAt: DateTime
}

"""Detailed information about a book"""
type BookDetail {
  """The unique identifier of the book"""
  id: String!

  """The title of the book"""
  title: String!

  """The authors of the book"""
  authors: [String!]!

  """The publisher of the book"""
  publisher: String

  """The publication date of the book"""
  publishedDate: String

  """The number of pages in the book"""
  pageCount: Int

  """The categories/genres of the book"""
  categories: [String!]

  """The description of the book"""
  description: String

  """The ISBN of the book"""
  isbn: String

  """The cover image URL of the book"""
  coverImageUrl: String

  """The Amazon URL for the book"""
  amazonUrl: String

  """The Google Books URL for the book"""
  googleBooksUrl: String

  """The user's reading record for this book (if added to shelf)"""
  userBook: UserBook
}
